<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AccounTally Pro</title>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap');
:root{--bg:#f0f2f5;--sidebar:#0f172a;--primary:#2563eb;--pd:#1d4ed8;--ok:#059669;--bad:#dc2626;--warn:#d97706;--sur:#fff;--bdr:#e2e8f0;--txt:#1e293b;--tm:#64748b;--tl:#94a3b8;--mono:'IBM Plex Mono',monospace;--font:'IBM Plex Sans',sans-serif;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:var(--font);background:var(--bg);color:var(--txt);height:100vh;display:flex;overflow:hidden;font-size:13px;}
#app{flex:1;min-width:0;width:100%;}
.hidden{display:none!important;}

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#login-wrap{position:fixed;inset:0;background:linear-gradient(135deg,#0f172a 0%,#1e3a6e 60%,#0f172a 100%);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;gap:0;}
.login-box{background:rgba(255,255,255,.07);border:1.5px solid rgba(255,255,255,.13);border-radius:20px;padding:40px 36px;width:380px;max-width:95vw;}
.login-logo{text-align:center;margin-bottom:28px;}
.login-logo-icon{font-size:42px;}
.login-logo-name{font-size:24px;font-weight:700;color:#fff;letter-spacing:-0.5px;margin-top:6px;}
.login-logo-sub{color:#93c5fd;font-size:12px;margin-top:3px;}
.login-field{margin-bottom:16px;}
.login-label{font-size:11px;font-weight:600;color:#94a3b8;margin-bottom:6px;display:block;}
.login-input{width:100%;padding:11px 14px;background:rgba(255,255,255,.08);border:1.5px solid rgba(255,255,255,.15);border-radius:10px;color:#fff;font-size:13px;font-family:var(--font);outline:none;transition:border .15s;}
.login-input:focus{border-color:#3b82f6;background:rgba(59,130,246,.1);}
.login-input::placeholder{color:#475569;}
.login-btn{width:100%;padding:12px;background:linear-gradient(135deg,#2563eb,#3b82f6);border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;font-family:var(--font);transition:all .15s;margin-top:4px;}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(37,99,235,.4);}
.login-error{background:rgba(220,38,38,.15);border:1px solid rgba(220,38,38,.3);border-radius:8px;padding:10px 14px;color:#fca5a5;font-size:12px;margin-bottom:14px;display:none;}
.login-footer{color:#334155;font-size:11px;text-align:center;margin-top:20px;}
.login-switch{color:#60a5fa;cursor:pointer;text-decoration:underline;}
.db-badge{background:rgba(5,150,105,.15);border:1px solid rgba(5,150,105,.25);border-radius:30px;padding:6px 16px;color:#34d399;font-size:11px;font-weight:600;margin-bottom:24px;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
#sidebar{width:220px;background:var(--sidebar);color:#fff;display:flex;flex-direction:column;flex-shrink:0;transition:width .2s;overflow:hidden;}
#sidebar.col{width:52px;}
.slg{padding:14px;border-bottom:1px solid #1e293b;display:flex;align-items:center;gap:10px;min-height:58px;}
.logo-n{font-size:13px;font-weight:700;color:#e2e8f0;white-space:nowrap;}
.logo-s{font-size:10px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:145px;}
.stog{background:none;border:none;color:#64748b;cursor:pointer;padding:6px;font-size:18px;flex-shrink:0;line-height:1;}
.stog:hover{color:#fff;}
.snav{flex:1;padding:8px 0;overflow-y:auto;}
.ni{display:flex;align-items:center;gap:10px;padding:9px 14px;cursor:pointer;color:#94a3b8;font-size:12.5px;font-weight:500;transition:all .15s;white-space:nowrap;border-left:3px solid transparent;}
.ni:hover{background:#1e293b;color:#e2e8f0;}
.ni.act{background:#1e3a6e;color:#fff;border-left-color:#2563eb;}
.nico{font-size:15px;flex-shrink:0;width:20px;text-align:center;}
.nsec{padding:12px 14px 4px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:#334155;white-space:nowrap;}
#sidebar.col .nsec,#sidebar.col .nlb,#sidebar.col .ltxt{display:none;}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
#main{flex:1;min-width:0;width:100%;display:flex;flex-direction:column;overflow:hidden;}
#topbar{background:var(--sur);border-bottom:1px solid var(--bdr);padding:0 20px;height:52px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;box-shadow:0 1px 3px rgba(0,0,0,.05);}
.pg-title{font-size:15px;font-weight:700;color:var(--txt);}
.tbr{display:flex;align-items:center;gap:8px;}
.fy-badge{background:#eff6ff;color:#2563eb;font-size:11px;font-weight:700;padding:3px 10px;border-radius:20px;border:1px solid #bfdbfe;}
.save-status{font-size:10px;font-weight:600;padding:3px 10px;border-radius:20px;}
.save-ok{background:#ecfdf5;color:#059669;border:1px solid #a7f3d0;}
.save-ing{background:#fefce8;color:#b45309;border:1px solid #fde68a;}
.usr-badge{background:#f1f5f9;color:#475569;font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;cursor:pointer;}
.usr-badge:hover{background:#e2e8f0;}
#content{flex:1;min-height:0;overflow-y:auto;padding:18px 22px;width:100%;}
.page-full{display:flex;flex-direction:column;min-height:calc(100vh - 88px);}
.page-full .pf-grid{flex:1;}

/* ‚îÄ‚îÄ CARDS & COMPONENTS ‚îÄ‚îÄ */
.card{background:var(--sur);border:1px solid var(--bdr);border-radius:12px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.04);}
.ch{background:#0f172a;color:#fff;padding:12px 18px;font-weight:700;font-size:13px;}
.sg{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:18px;}
.sc{border-radius:12px;padding:16px;color:#fff;position:relative;overflow:hidden;}
.sc::after{content:'';position:absolute;right:-8px;top:-8px;width:72px;height:72px;background:rgba(255,255,255,.07);border-radius:50%;}
.sl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;opacity:.8;}
.sv{font-size:20px;font-weight:700;margin-top:5px;font-family:var(--mono);}
.ss{font-size:10px;opacity:.65;margin-top:2px;}
.sc-b{background:linear-gradient(135deg,#2563eb,#3b82f6);}
.sc-g{background:linear-gradient(135deg,#059669,#10b981);}
.sc-r{background:linear-gradient(135deg,#dc2626,#ef4444);}
.sc-p{background:linear-gradient(135deg,#7c3aed,#8b5cf6);}
.sc-o{background:linear-gradient(135deg,#d97706,#f59e0b);}

.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:600;font-family:var(--font);transition:all .15s;white-space:nowrap;}
.btn-p{background:var(--primary);color:#fff;}.btn-p:hover{background:var(--pd);}
.btn-s{background:var(--ok);color:#fff;}.btn-s:hover{background:#047857;}
.btn-d{background:var(--bad);color:#fff;}.btn-d:hover{background:#b91c1c;}
.btn-g{background:var(--bdr);color:var(--txt);}.btn-g:hover{background:#cbd5e1;}
.btn-w{background:#fff7ed;color:#c2410c;border:1px solid #fed7aa;}.btn-w:hover{background:#ffedd5;}
.btn-sm{padding:4px 9px;font-size:11px;}
.btn:disabled{opacity:.4;cursor:not-allowed;}

.tb{display:flex;align-items:center;gap:9px;margin-bottom:12px;flex-wrap:wrap;}
.tg{display:flex;gap:3px;background:var(--bdr);padding:3px;border-radius:8px;}
.t{padding:5px 11px;border-radius:6px;border:none;cursor:pointer;font-size:11px;font-weight:600;background:none;color:var(--tm);font-family:var(--font);transition:all .15s;}
.t.act{background:#fff;color:var(--primary);box-shadow:0 1px 3px rgba(0,0,0,.1);}
.t:hover:not(.act){color:var(--txt);}

.si{padding:7px 12px;border:1px solid var(--bdr);border-radius:8px;font-size:12px;font-family:var(--font);outline:none;transition:border .15s;min-width:180px;}
.si:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.08);}

.tbl{width:100%;border-collapse:collapse;}
.tbl th{background:#0f172a;color:#e2e8f0;padding:9px 13px;text-align:left;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;}
.tbl td{padding:9px 13px;border-bottom:1px solid var(--bdr);font-size:12.5px;vertical-align:middle;}
.tbl tr:last-child td{border-bottom:none;}
.tbl tr:hover td{background:#f8fafc;}
.tbl tr.alt td{background:#fafafa;}.tbl tr.alt:hover td{background:#f0f4ff;}
.tf td{background:#0f172a!important;color:#fff!important;font-weight:700!important;}

.mono{font-family:var(--mono);}.tr{text-align:right;}.tc{text-align:center;}
.tb-{color:#2563eb;}.tg-{color:#059669;}.tr-{color:#dc2626;}.tm-{color:var(--tm);}

.badge{display:inline-flex;align-items:center;padding:2px 8px;border-radius:20px;font-size:10px;font-weight:700;white-space:nowrap;}
.bb{background:#eff6ff;color:#1d4ed8;}.bg-{background:#ecfdf5;color:#059669;}
.br{background:#fef2f2;color:#dc2626;}.by{background:#fefce8;color:#b45309;}
.bp{background:#faf5ff;color:#7c3aed;}.bgr{background:#f1f5f9;color:#475569;}
.bo{background:#fff7ed;color:#c2410c;}

.fg{display:grid;grid-template-columns:repeat(auto-fit,minmax(175px,1fr));gap:11px;}
.fgr{display:flex;flex-direction:column;gap:4px;}
.fl{font-size:11px;font-weight:600;color:var(--tm);}
.fc{padding:8px 10px;border:1px solid var(--bdr);border-radius:8px;font-size:12.5px;font-family:var(--font);outline:none;transition:border .15s;background:#fff;width:100%;}
.fc:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.08);}
.fc:disabled{background:#f8fafc;color:var(--tm);}

.fp{background:#f8fafc;border:1px solid var(--bdr);border-radius:12px;padding:18px;margin-bottom:14px;}

.al{padding:10px 13px;border-radius:8px;font-size:12px;margin-bottom:10px;}
.al-s{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0;}
.al-d{background:#fef2f2;color:#991b1b;border:1px solid #fca5a5;}
.al-w{background:#fefce8;color:#92400e;border:1px solid #fde68a;}
.al-i{background:#eff6ff;color:#1e40af;border:1px solid #bfdbfe;}

.et{width:100%;border-collapse:collapse;border:1px solid var(--bdr);border-radius:8px;overflow:hidden;}
.et th{background:#334155;color:#e2e8f0;padding:8px 10px;font-size:11px;font-weight:700;text-align:left;}
.et td{padding:6px 8px;border-bottom:1px solid var(--bdr);}
.et tfoot td{background:#f8fafc;font-weight:700;padding:8px 10px;}
.et tfoot.bal td{background:#ecfdf5;color:#065f46;}
.et tfoot.unbal td{background:#fef2f2;color:#991b1b;}

.mo{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:1000;padding:16px;}
.mo.hidden{display:none;}
.mb{background:#fff;border-radius:16px;max-width:780px;width:100%;max-height:92vh;overflow-y:auto;box-shadow:0 25px 60px rgba(0,0,0,.3);}
.mh{background:#0f172a;color:#fff;padding:15px 20px;display:flex;align-items:center;justify-content:space-between;border-radius:16px 16px 0 0;}
.mbdy{padding:20px;}
.mc{background:none;border:none;color:#94a3b8;cursor:pointer;font-size:20px;line-height:1;}
.mc:hover{color:#fff;}

.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;}

.rp{background:var(--sur);border:1px solid var(--bdr);border-radius:12px;padding:18px;}
.rst{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--tl);margin-bottom:7px;margin-top:14px;}
.rr{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px dashed var(--bdr);}
.rrl{color:var(--txt);padding-left:12px;}
.rrv{font-weight:600;font-family:var(--mono);}
.rtot{display:flex;justify-content:space-between;padding:9px 12px;border-radius:8px;font-weight:700;margin-top:7px;}
.rt-b{background:#eff6ff;color:#1e40af;}.rt-g{background:#ecfdf5;color:#065f46;}.rt-r{background:#fef2f2;color:#991b1b;}
.rg{background:#0f172a;color:#fff;border-radius:10px;padding:12px 16px;display:flex;justify-content:space-between;font-weight:700;margin-top:10px;font-size:13px;}

.qg{display:grid;grid-template-columns:repeat(6,1fr);gap:9px;}
.ql{display:flex;flex-direction:column;align-items:center;gap:7px;padding:14px 7px;border-radius:12px;border:2px solid;cursor:pointer;background:none;font-family:var(--font);transition:all .15s;}
.ql:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.1);}
.qi{font-size:20px;}.qlb{font-size:10px;font-weight:700;text-align:center;}
.q1{border-color:#bfdbfe;color:#1d4ed8;background:#eff6ff;}
.q2{border-color:#a7f3d0;color:#065f46;background:#ecfdf5;}
.q3{border-color:#ddd6fe;color:#5b21b6;background:#f5f3ff;}
.q4{border-color:#fed7aa;color:#9a3412;background:#fff7ed;}
.q5{border-color:#fca5a5;color:#991b1b;background:#fef2f2;}
.q6{border-color:#99f6e4;color:#0f766e;background:#f0fdfa;}
.q7{border-color:#e9d5ff;color:#6b21a8;background:#faf5ff;}
.q8{border-color:#bae6fd;color:#0369a1;background:#f0f9ff;}

::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}
/* Hide number input spinners globally */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0;}
input[type=number]{-moz-appearance:textfield;}

/* ‚îÄ‚îÄ TOAST ANIMATION ‚îÄ‚îÄ */
@keyframes fadeInUp{
  from{opacity:0;transform:translateY(16px);}
  to{opacity:1;transform:translateY(0);}
}

/* ‚îÄ‚îÄ DUE DATE COLORS ‚îÄ‚îÄ */
.due-over{color:#dc2626;font-weight:700;}
.due-warn{color:#d97706;font-weight:700;}
.due-ok{color:#059669;}
.due-badge-over{background:#fef2f2;color:#991b1b;border:1px solid #fca5a5;}
.due-badge-warn{background:#fefce8;color:#92400e;border:1px solid #fde68a;}
.due-badge-ok{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0;}

/* ‚îÄ‚îÄ SVG CHART ‚îÄ‚îÄ */
.chart-legend{display:flex;gap:14px;margin-bottom:10px;font-size:11px;font-weight:600;}
.leg-dot{width:10px;height:10px;border-radius:2px;display:inline-block;margin-right:4px;}
.chart-wrap{background:#fff;border-radius:12px;border:1px solid var(--bdr);padding:14px;overflow:hidden;}

/* ‚îÄ‚îÄ PRINT / PDF ‚îÄ‚îÄ */
@media print{
  #login-wrap,#sidebar,#topbar,.tb,.no-print{display:none!important;}
  #content{padding:0;}
  body{height:auto;overflow:visible;}
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê LOGIN ‚ïê‚ïê -->
<div id="login-wrap">
  <div class="db-badge">‚òÅÔ∏è Supabase Cloud Storage ‚Äî Data saved permanently online</div>
  <div class="login-box">
    <div class="login-logo">
      <div class="login-logo-icon">üìä</div>
      <div class="login-logo-name">AccounTally Pro</div>
      <div class="login-logo-sub">Professional Accounting Software</div>
    </div>
    <div class="login-error" id="login-err"></div>
    <div id="login-form-wrap">
      <div class="login-field">
        <label class="login-label">Username</label>
        <input class="login-input" id="li-user" placeholder="Enter username" autocomplete="username">
      </div>
      <div class="login-field">
        <label class="login-label">Password</label>
        <input class="login-input" id="li-pass" type="password" placeholder="Enter password" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()">
      </div>
      <button class="login-btn" onclick="doLogin()">Sign In ‚Üí</button>
    </div>
    <div id="setup-form-wrap" class="hidden">
      <div class="al al-i" style="margin-bottom:14px;">üëã First launch ‚Äî create your admin account</div>
      <div class="login-field">
        <label class="login-label">Company Name</label>
        <input class="login-input" id="su-company" placeholder="e.g. My Business Pvt. Ltd." value="My Business Pvt. Ltd.">
      </div>
      <div class="login-field">
        <label class="login-label">Admin Username</label>
        <input class="login-input" id="su-user" placeholder="admin">
      </div>
      <div class="login-field">
        <label class="login-label">Password</label>
        <input class="login-input" id="su-pass" type="password" placeholder="Min 4 characters">
      </div>
      <div class="login-field">
        <label class="login-label">Confirm Password</label>
        <input class="login-input" id="su-pass2" type="password" placeholder="Re-enter password">
      </div>
      <div class="login-field">
        <label class="login-label">GSTIN (optional)</label>
        <input class="login-input" id="su-gstin" placeholder="e.g. 27AAPFU0939F1ZV" maxlength="15" style="text-transform:uppercase;">
      </div>
      <button class="login-btn" onclick="doSetup()">Create Account & Start ‚Üí</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê APP ‚ïê‚ïê -->
<div id="app" class="hidden" style="display:flex;width:100%;height:100vh;overflow:hidden;">
  <nav id="sidebar">
    <div class="slg">
      <button class="stog" onclick="toggleSidebar()">‚ò∞</button>
      <div class="ltxt">
        <div class="logo-n" id="sb-company">My Business</div>
        <div class="logo-s" id="sb-fy">FY 2025-26</div>
      </div>
    </div>
    <div class="snav">
      <div class="nsec">Main</div>
      <div class="ni act" id="nav-dashboard" onclick="navigate('dashboard')"><span class="nico">üè†</span><span class="nlb">Dashboard</span></div>
      <div class="nsec">Masters</div>
      <div class="ni" id="nav-accounts" onclick="navigate('accounts')"><span class="nico">üìã</span><span class="nlb">Chart of Accounts</span></div>
      <div class="ni" id="nav-items" onclick="navigate('items')"><span class="nico">üì¶</span><span class="nlb">Item Master (HSN/SAC)</span></div>
      <div class="ni" id="nav-vendors" onclick="navigate('vendors')"><span class="nico">üè≠</span><span class="nlb">Vendors / Suppliers</span></div>
      <div class="ni" id="nav-debtors" onclick="navigate('debtors')"><span class="nico">ü§ù</span><span class="nlb">Customers / Debtors</span></div>
      <div class="nsec">Transactions</div>
      <div class="ni" id="nav-vouchers" onclick="navigate('vouchers')"><span class="nico">üìù</span><span class="nlb">Voucher Entry</span></div>
      <div class="ni" id="nav-advances" onclick="navigate('advances')"><span class="nico">üí∞</span><span class="nlb">Advance Payments</span></div>
      <div class="nsec">Books</div>
      <div class="ni" id="nav-daybook" onclick="navigate('daybook')"><span class="nico">üìÖ</span><span class="nlb">Day Book</span></div>
      <div class="ni" id="nav-cashbook" onclick="navigate('cashbook')"><span class="nico">üíµ</span><span class="nlb">Cash Book</span></div>
      <div class="ni" id="nav-ledger" onclick="navigate('ledger')"><span class="nico">üìñ</span><span class="nlb">Ledger</span></div>
      <div class="ni" id="nav-bankrecon" onclick="navigate('bankrecon')"><span class="nico">üè¶</span><span class="nlb">Bank Reconciliation</span></div>
      <div class="nsec">Registers</div>
      <div class="ni" id="nav-reg-sales" onclick="navigate('reg-sales')"><span class="nico">üßæ</span><span class="nlb">Sales Register</span></div>
      <div class="ni" id="nav-reg-purchase" onclick="navigate('reg-purchase')"><span class="nico">üõí</span><span class="nlb">Purchase Register</span></div>
      <div class="ni" id="nav-reg-debit" onclick="navigate('reg-debit')"><span class="nico">üì§</span><span class="nlb">Debit Note Register</span></div>
      <div class="ni" id="nav-reg-credit" onclick="navigate('reg-credit')"><span class="nico">üì•</span><span class="nlb">Credit Note Register</span></div>
      <div class="ni" id="nav-reg-journal" onclick="navigate('reg-journal')"><span class="nico">üìì</span><span class="nlb">Journal Register</span></div>
      <div class="nsec">Reports</div>
      <div class="ni" id="nav-trial" onclick="navigate('trial')"><span class="nico">‚öñÔ∏è</span><span class="nlb">Trial Balance</span></div>
      <div class="ni" id="nav-pnl" onclick="navigate('pnl')"><span class="nico">üìä</span><span class="nlb">Profit & Loss</span></div>
      <div class="ni" id="nav-balance" onclick="navigate('balance')"><span class="nico">üèó</span><span class="nlb">Balance Sheet</span></div>
      <div class="ni" id="nav-cashflow" onclick="navigate('cashflow')"><span class="nico">üí∏</span><span class="nlb">Cash Flow (AS-3)</span></div>
      <div class="ni" id="nav-gst" onclick=
